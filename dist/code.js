var _a,_b,_c,__awaiter=this&&this.__awaiter||function(e,t,i,a){return new(i||(i=Promise))(function(n,_){function m(e){try{l(a.next(e))}catch(e){_(e)}}function o(e){try{l(a.throw(e))}catch(e){_(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(m,o)}l((a=a.apply(e,t||[])).next())})};let config={};const selection=figma.currentPage.selection[0];function isJsonString(e){try{JSON.parse(e)}catch(e){return!1}return!0}if(1===figma.currentPage.selection.length)if("FRAME"===selection.type){let e=figma.currentPage.selection[0].width,t=figma.currentPage.selection[0].height,i=0;for(const a of Object.keys(figma.currentPage.selection[0].children)){if("GROUP"===selection.children[a].type){i++;let n=selection.children[a],_=n.name;config[_+"_"+i]={title:_,item_type:"ITEM_TYPE.single",items:{}};let m=0;for(const a of n.children)if("INSTANCE"===a.type&&!0===a.visible){m++;let n=a.name;config[_+"_"+i].items[n+"_"+m]={title:n,items:{}},"multisensor"===a.mainComponent.name&&(config[_+"_"+i].items[n+"_"+m].item_type="ITEM_TYPE.single",config[_+"_"+i].items[n+"_"+m].param_type="PARAM_TYPE.value",config[_+"_"+i].items[n+"_"+m].custom_data={template:"multisensorTemplate",top:a.y/t*100,left:a.x/e*100,placement:"auto"},config[_+"_"+i].items[n+"_"+m].items={temperature:{title:"Temperature"},humidity:{title:"Humidity"},noise:{title:"Noise"},co2:{title:"CO2"},lighting:{title:"Lighting"}}),"reedswitch"===a.mainComponent.name&&(config[_+"_"+i].items[n+"_"+m].item_type="ITEM_TYPE.single",config[_+"_"+i].items[n+"_"+m].param_type="PARAM_TYPE.signal",config[_+"_"+i].items[n+"_"+m].custom_data={template:"reedSwitchTemplate",top:a.y/t*100,left:a.x/e*100,placement:"auto"},config[_+"_"+i].items[n+"_"+m].items={reed_switch:{title:"Reed switch"}}),"door"===a.mainComponent.name&&(config[_+"_"+i].items[n+"_"+m].item_type="ITEM_TYPE.single",config[_+"_"+i].items[n+"_"+m].param_type="PARAM_TYPE.signal",config[_+"_"+i].items[n+"_"+m].custom_data={template:"doorStateTemplate",top:a.y/t*100,left:a.x/e*100,placement:"auto"},config[_+"_"+i].items[n+"_"+m].items={door_reed_switch:{title:"Door state"}}),"mnemoscheme/switch"===a.mainComponent.parent.name&&(config[_+"_"+i].items[n+"_"+m].item_type="ITEM_TYPE.single",config[_+"_"+i].items[n+"_"+m].param_type="PARAM_TYPE.signal",config[_+"_"+i].items[n+"_"+m].custom_data={template:"mnemoschemeSwitchTemplate",top:a.y/t*100,left:a.x/e*100,width:a.width,rotation_angle:a.rotation,placement:"auto"},config[_+"_"+i].items[n+"_"+m].items={mnemoscheme_switch:{title:"Mnemoscheme switch state"}}),"camera"===a.mainComponent.name&&(config[_+"_"+i].items[n+"_"+m].item_type="ITEM_TYPE.single",config[_+"_"+i].items[n+"_"+m].param_type="PARAM_TYPE.value",config[_+"_"+i].items[n+"_"+m].custom_data={template:"cameraTemplate",top:a.y/t*100,left:a.x/e*100,placement:"auto",direction:-a.rotation},config[_+"_"+i].items[n+"_"+m].items={channel:{title:"Channel",item_type:"ITEM_TYPE.single",param_type:"PARAM_TYPE.value"},alarm_state:{title:"Alarm state",item_type:"ITEM_TYPE.single",param_type:"PARAM_TYPE.signal"},work_state:{title:"Work state",item_type:"ITEM_TYPE.single",param_type:"PARAM_TYPE.signal"},detect_mask:{title:"Detect mask",item_type:"ITEM_TYPE.single",param_type:"PARAM_TYPE.increment"},detect_group:{title:"Detect applicant and student meeting",item_type:"ITEM_TYPE.single",param_type:"PARAM_TYPE.increment"}}),"lightline"===a.mainComponent.name&&(config[_+"_"+i].items[n+"_"+m].item_type="ITEM_TYPE.single",config[_+"_"+i].items[n+"_"+m].param_type="PARAM_TYPE.signal",config[_+"_"+i].items[n+"_"+m].custom_data={template:"lightLineTemplate",top:a.y/t*100,left:a.x/e*100,length:a.height/t*100,rotation_angle:a.rotation,placement:"auto"},config[_+"_"+i].items[n+"_"+m].items={light_line:{title:"Light line"}}),"fancoil"===a.mainComponent.name&&(config[_+"_"+i].items[n+"_"+m].item_type="ITEM_TYPE.single",config[_+"_"+i].items[n+"_"+m].param_type="PARAM_TYPE.signal",config[_+"_"+i].items[n+"_"+m].custom_data={template:"fancoilTemplate",top:a.y/t*100,left:a.x/e*100,placement:"auto"},config[_+"_"+i].items[n+"_"+m].items={speed:{title:"Blowing speed",item_type:"ITEM_TYPE.single",param_type:"PARAM_TYPE.value"},operating_mode:{title:"Operating mode",item_type:"ITEM_TYPE.single",param_type:"PARAM_TYPE.value"},control_flag:{title:"Control flag",item_type:"ITEM_TYPE.single",param_type:"PARAM_TYPE.value"}}),"ventilation"===a.mainComponent.name&&(config[_+"_"+i].items[n+"_"+m].item_type="ITEM_TYPE.single",config[_+"_"+i].items[n+"_"+m].param_type="PARAM_TYPE.signal",config[_+"_"+i].items[n+"_"+m].custom_data={template:"ventilationTemplate",top:a.y/t*100,left:a.x/e*100,placement:"auto"},config[_+"_"+i].items[n+"_"+m].items={mode:{title:"Work mode on/off"},error_code:{title:"Error code",item_type:"ITEM_TYPE.single",param_type:"PARAM_TYPE.value"},filter_contamination:{title:"Filter contamination",item_type:"ITEM_TYPE.single",param_type:"PARAM_TYPE.value"},rotation_speed:{title:"Rotation speed",item_type:"ITEM_TYPE.single",param_type:"PARAM_TYPE.value"},temperature_in_channel:{title:"Temperature in channel",item_type:"ITEM_TYPE.single",param_type:"PARAM_TYPE.value"}}),"universal"===a.mainComponent.parent.name&&(config[_+"_"+i].items[n+"_"+m].item_type="ITEM_TYPE.single",config[_+"_"+i].items[n+"_"+m].param_type="PARAM_TYPE.signal",config[_+"_"+i].items[n+"_"+m].custom_data={template:"universalTemplate",device_type_id:null===(_a=a.mainComponent)||void 0===_a?void 0:_a.id,device_type_en:a.variantProperties["Device type (en)"],device_type_ru:a.variantProperties["Device type (ru)"],top:a.y/t*100,left:a.x/e*100,placement:"auto",icon_path:null===(_c=null===(_b=a.children[0].mainComponent)||void 0===_b?void 0:_b.children[0])||void 0===_c?void 0:_c.fillGeometry},isJsonString(a.mainComponent.description)?(config[_+"_"+i].items[n+"_"+m].custom_data.device_type_description_en=JSON.parse(a.mainComponent.description).en,config[_+"_"+i].items[n+"_"+m].custom_data.device_type_description_ru=JSON.parse(a.mainComponent.description).ru):(config[_+"_"+i].items[n+"_"+m].custom_data.device_type_description_en="",config[_+"_"+i].items[n+"_"+m].custom_data.device_type_description_ru=""),config[_+"_"+i].items[n+"_"+m].items={parameter_1:{title:"Parameter 1",item_type:"ITEM_TYPE.single",param_type:"PARAM_TYPE.value"},parameter_2:{title:"Parameter 2",item_type:"ITEM_TYPE.single",param_type:"PARAM_TYPE.value"},parameter_3:{title:"Parameter 3",item_type:"ITEM_TYPE.single",param_type:"PARAM_TYPE.value"},parameter_4:{title:"Parameter 4",item_type:"ITEM_TYPE.single",param_type:"PARAM_TYPE.value"},parameter_5:{title:"Parameter 5",item_type:"ITEM_TYPE.single",param_type:"PARAM_TYPE.value"},parameter_6:{title:"Parameter 6",item_type:"ITEM_TYPE.single",param_type:"PARAM_TYPE.value"},parameter_7:{title:"Parameter 7",item_type:"ITEM_TYPE.single",param_type:"PARAM_TYPE.value"},parameter_8:{title:"Parameter 8",item_type:"ITEM_TYPE.single",param_type:"PARAM_TYPE.value"},parameter_9:{title:"Parameter 9",item_type:"ITEM_TYPE.single",param_type:"PARAM_TYPE.value"},parameter_10:{title:"Parameter 10",item_type:"ITEM_TYPE.single",param_type:"PARAM_TYPE.value"}})}}console.log(config)}}else figma.notify("Selection is not a frame. Please select one frame."),figma.closePlugin();else figma.notify("Please select only one frame to run plugin."),figma.closePlugin();const activateUtilitiesUi=()=>{figma.showUI(__html__,{visible:!1})};"export"===figma.command&&(activateUtilitiesUi(),figma.ui.postMessage({command:"export",data:{filename:"plan_configuration.json",data:JSON.stringify(config)}})),"help"===figma.command&&(activateUtilitiesUi(),figma.ui.postMessage({command:"help"})),figma.ui.onmessage=(e=>__awaiter(this,void 0,void 0,function*(){"closePlugin"===e.command&&(void 0!==e.notification&&""!==e.notification&&figma.notify(e.notification),figma.closePlugin())}));